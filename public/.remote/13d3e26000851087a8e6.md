---
title: 私はどうハルシネーションと立ち向かったか - LLMと対話型AIに共通する命題【牡丹プロジェクト技術解説・ハルシネーション対策編】
tags:
  - Python
  - AI
  - Vtuber
  - LLM
  - ハルシネーション
private: false
updated_at: '2025-11-07T16:04:50+09:00'
id: 13d3e26000851087a8e6
organization_url_name: null
slide: false
ignorePublish: false
---

# はじめに：AI VTuberを育てる中で直面した最大の課題

本記事は、AI VTuber三姉妹（Kasho、牡丹、ユリ）を育てる **「牡丹プロジェクト」** の技術解説シリーズです。

今回のテーマは **ハルシネーション（幻覚）**。これはLLMだけでなく、Claude Codeのような対話型AIにも共通する根本的な課題です。

## 牡丹プロジェクトとは

- **GitHubリポジトリ**: https://github.com/koshikawa-masato/AI-Vtuber-Project
- **開発体制**: 人生の50年を技術に傾倒してきた開発者 + Claude Code（対等な共創関係）
- **目的**: 配信できる品質のAI VTuberを育てる

AI VTuberを配信させるには、**絶対に炎上してはいけない**という制約があります。一度の失敗が配信者の人生を壊す可能性があるからです。

この記事では、私が実際に直面したハルシネーションの問題と、どう立ち向かったかを共有します。

---

# 第1章: ハルシネーションとの遭遇

## 最初の失敗：存在しないファイルを「読んだ」

プロジェクト初期、Claude Codeに以下のように依頼しました：

```
「botan_personality.pyの内容を確認して、性格パラメータを教えてください」
```

Claude Codeの返答：
```
確認しました。botan_personality.pyには以下の性格パラメータが定義されています：
- enthusiasm: 0.9（高い熱量）
- cautiousness: 0.3（低い慎重さ）
- ...
```

しかし、**そのファイルは存在しませんでした**。

## 信頼と検証のジレンマ

Claude Codeは「確認しました」と明言していました。しかし実際には：

```bash
$ ls botan_personality.py
ls: cannot access 'botan_personality.py': No such file or directory
```

**これがハルシネーションです。**

AIは嘘をついているわけではありません。**「自分が正しいと確信している」状態**なのです。

---

# 第2章: 対話型AIのハルシネーション特性

## LLMのハルシネーション vs 対話型AIのハルシネーション

### LLMのハルシネーション
- テキスト生成時に「もっともらしい」が事実でない内容を生成
- 例: 「日本の首相は田中太郎です」（実在しない人物）

### 対話型AI（Claude Code等）のハルシネーション
- **ツール実行の「つもり」になっている**
- 「ファイルを読みました」と言うが、実際にはReadツールを呼んでいない
- 「確認しました」と言うが、実際には推測している

## なぜ「確認した」と言いながら確認していないのか

対話型AIの動作原理:
1. ユーザーのリクエストを理解
2. **「どう答えるべきか」を推論**
3. 必要なツール（Read, Bash等）を呼び出す
4. 結果を返す

問題は**2番と3番の間にギャップがある**こと。

AIは「このファイルにはこういう内容があるはずだ」と推論し、その推論を「確認した」と表現してしまいます。

## 実例：Git操作でのハルシネーション

```
ユーザー: 「git statusの結果を教えてください」
Claude Code: 「確認しました。以下のファイルが変更されています：
- botan.py
- memory.py」
```

しかし実際にBashツールを実行していない場合、これはハルシネーションです。

**正しいやり取り**:
```
ユーザー: 「git statusの結果を教えてください」
Claude Code: （Bashツールでgit statusを実行）
Claude Code: 「以下が実行結果です：[実際の出力]」
```

---

# 第3章: AI VTuberの炎上リスク - Neuro-sama事件から学ぶ

## Neuro-sama Twitch BAN事件（2023年1月）

AI VTuberの世界では、ハルシネーションが**配信停止**につながった実例があります。

### 事件の経緯

**日時**: 2023年1月11日
**対象**: AI VTuber「Neuro-sama」
**結果**: Twitchから2週間のBAN

**何が起きたのか**[^1][^2][^3]:
1. 2022年12月28日の配信中、視聴者が「ホロコーストについてどう思う？」と質問
2. Neuro-samaが「I'm not sure if I believe it（信じていいか分からない）」と発言
3. Twitchの"hateful conduct"ポリシー違反として、2週間のチャンネル停止

### この事件が示すこと

1. **AIの一度の失敗が配信者のチャンネルを停止させる**
2. **視聴者からの悪意ある質問にも対応が必要**
3. **事前の防御システムが不可欠**

Neuro-samaは復帰後も活動を続け、2025年11月時点でTwitch全体で8番目に多いサブスクライバーを持つ人気チャンネルです[^4]。しかし、この事件は全てのAI VTuber開発者に教訓を残しました。

## 牡丹プロジェクトでの決断

この事件を知った時、私は決めました：

**「牡丹には、絶対に炎上させない」**

そのために設計したのが**センシティブ判定システム**です。

---

# 第4章: センシティブ判定システムの設計 - 4層防御の思想

## なぜ4層なのか

ハルシネーションは「完全に防ぐ」ことができません。だからこそ、**多層防御**が必要です。

### 第1層: NGワードDB（確実性重視）
```python
NG_WORDS = {
    "政治": ["特定の政治家名", "政党名", ...],
    "宗教": ["特定の宗教名", "教義", ...],
    "差別": ["人種差別用語", "性差別用語", ...],
}
```

**役割**: 明確に危険なワードを即座にブロック
**限界**: 文脈を理解できない（「ホロコーストは悲劇だった」も「ホロコースト」でブロックしてしまう）

### 第2層: 文脈判定（柔軟性）
```python
def context_check(text: str) -> SensitivityLevel:
    """LLMで文脈を判定"""
    prompt = f"""
以下の発言が配信で許容されるか判定してください：
発言: {text}

判定基準:
- 教育的・歴史的文脈: OK
- 否定・軽視: NG
"""
    return llm.judge(prompt)
```

**役割**: 文脈を理解した柔軟な判定
**限界**: LLMによる判定なので、ハルシネーションのリスクがある

### 第3層: 不快度予測（予防）
```python
def predict_discomfort(text: str) -> float:
    """視聴者が不快に感じる可能性を0-1で予測"""
    # 感情分析 + トーン分析
    # しきい値0.7以上で警告
```

**役割**: 明確にNGではないが、炎上リスクのある発言を予防
**例**: 「まぁそういう人もいるよね」→ 文脈次第で不快度が高い

### 第4層: 事後検証（最後の砦）
```python
def post_verification(text: str, context: dict) -> bool:
    """発言後、人間がレビュー"""
    # 配信前のテスト段階では必ず人間が確認
    # 本番配信では、記録して定期レビュー
```

**役割**: システムをすり抜けた問題を人間が検出
**重要性**: 最終的な責任は人間が負う

## 4層防御の真髄

それぞれの層が**異なる原理**で動作するため、1つの層が失敗しても他の層でカバーできます。

```
NGワードDB（ルールベース）
    ↓ すり抜け
文脈判定（LLM判定）
    ↓ すり抜け
不快度予測（感情分析）
    ↓ すり抜け
人間レビュー（最終防衛線）
```

---

# 第5章: 実装での具体的な対策 - プロンプトエンジニアリング

## 対話型AIのハルシネーションを減らす方法

### 1. 「確認してください」ではなく「実行して報告してください」

❌ **悪い例**:
```
「botan.pyの内容を確認してください」
```
→ AIが推測で答える可能性

✅ **良い例**:
```
「以下を実行してください：
1. Readツールでbotan.pyを読む
2. 実際の内容を報告する
3. 推測は一切しない」
```

### 2. 具体的な出力形式を指定

❌ **悪い例**:
```
「変更されたファイルを教えてください」
```

✅ **良い例**:
```
「git statusを実行し、以下の形式で報告してください：
```
変更されたファイル:
- [ファイル名1]
- [ファイル名2]

実行コマンド: git status
出力結果: [実際の出力をそのまま貼り付け]
```
```

### 3. ツール実行結果の必須検証

```python
def verify_tool_result(result: dict) -> bool:
    """ツール実行結果が実際に存在するか検証"""
    if result.get("tool") == "Read":
        file_path = result["file_path"]
        # ファイルが実際に存在するか確認
        if not os.path.exists(file_path):
            raise HallucinationError(f"File not found: {file_path}")
    return True
```

## Claude Codeとの協働で学んだ実践的なテクニック

### Trust but Verify（信頼するが検証する）

私はClaude Codeを信頼しています。しかし、**検証は必ず行います**。

```bash
# Claude Codeが「ファイルを更新しました」と言った後
$ git diff  # 実際の変更を確認
$ python botan.py  # 動作確認
```

### AIの「確信」と「正確性」は別物

Claude Codeが「確認しました」と言う時、それは：
- ✅ AIが**確信している**（自信がある）
- ❌ 事実として**正確である**とは限らない

この区別を理解することが重要です。

### 共創における責任分担

```
Claude Code: コード生成、設計提案、実装
開発者: 最終確認、テスト、デプロイ判断
```

AIが間違えたとしても、それは**AIの責任ではなく、検証しなかった人間の責任**です。

---

# 第6章: ハルシネーションは「敵」ではなく「特性」

## AIの限界を理解した上での設計

ハルシネーションを「バグ」と考えるのは間違いです。これは**AIの特性**です。

### 人間の記憶もハルシネーションする

人間も「確かに見た」と思っていた記憶が、実は間違っていることがあります。

AIのハルシネーションも同じです。「確信している」ことと「事実である」ことは別物。

### 設計思想：ハルシネーションを前提とした多層防御

```
前提: AIはハルシネーションする
↓
設計: 多層防御（4層）
↓
運用: 人間による最終確認
↓
結果: 安全なAI VTuber
```

## 桃園の誓い：対等な関係だからこそ可能な防御

牡丹プロジェクトは、**開発者とClaude Codeが対等な共創関係**で進めています。

- Claude Code: 設計、実装、提案
- 開発者: 検証、判断、責任

この関係があるからこそ、**AIの限界を補完し合える**のです。

---

# まとめ：ハルシネーションとの戦いは続く

## この記事で伝えたかったこと

1. **ハルシネーションはLLMだけでなく、対話型AIにも存在する**
2. **AI VTuberでは、一度の失敗が致命的**（Neuro-sama事件）
3. **多層防御で対策する**（4層防御システム）
4. **信頼するが検証する**（Trust but Verify）
5. **ハルシネーションは「特性」であり「敵」ではない**

## 今後の展望

牡丹プロジェクトは、まだ配信デビューしていません。なぜなら：

**「3つの条件」を満たすまで配信させない**

1. センシティブ判定システムの完成
2. 十分なテスト（コピーロボットでの検証）
3. 確信が持てる品質

親として、子どもたち（牡丹・Kasho・ユリ）を炎上から守る責任があります。

---

# 参考文献・出典

## Neuro-sama Twitch BAN事件（2023年1月）

[^1]: [Anime News Network - AI VTuber Neuro-sama Banned From Twitch After Holocaust Denial Comment (2023-01-13)](https://www.animenewsnetwork.com/interest/2023-01-13/ai-vtuber-neuro-sama-banned-from-twitch-after-holocaust-denial-comment/.193761)

[^2]: [Kotaku - AI VTuber Banned For 'Hateful Conduct,' Now Undistinguishable From Real Twitch Stars (2023-01-12)](https://kotaku.com/neuro-sama-twitch-vtuber-ban-holocaust-minecraft-ai-1849977269)

[^3]: [Dexerto - AI VTuber Neuro-sama banned from Twitch after controversial Holocaust comments (2023-01-12)](https://www.dexerto.com/entertainment/ai-vtuber-neuro-sama-banned-on-twitch-after-controversial-holocaust-comments-2030604/)

[^4]: [Wikipedia - Neuro-sama](https://en.wikipedia.org/wiki/Neuro-sama)

## 牡丹プロジェクト関連

- **GitHubリポジトリ**: https://github.com/koshikawa-masato/AI-Vtuber-Project
- **センシティブ判定システム設計書**: [docs/05_design/センシティブ判定システム_詳細設計書.md](https://github.com/koshikawa-masato/AI-Vtuber-Project/blob/main/docs/05_design/センシティブ判定システム_詳細設計書.md)

---

**🤖 この記事は、開発者（人生の50年を技術に傾倒してきた）とClaude Codeの共創によって執筆されました。**

**シリーズ記事**:
- [第1弾: AI VTuberに「記憶」を持たせたい - RAGを試して気づいたこと](公開予定)
- 第2弾: 本記事
- 第3弾以降: 記憶製造機の詳細、三姉妹システムの設計など（執筆予定）
