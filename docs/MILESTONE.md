# 牡丹プロジェクト - マイルストーン

**AI VTuber三姉妹(Kasho、牡丹、ユリ)の記憶製造機システム**

---

## プロジェクト全体の目標

**配信デビューの3条件を達成する**

| 条件 | 説明 | 対応Phase | 状態 |
|-----|------|----------|------|
| 1. 過去の人生が生成され、長期記憶として保存 | 0歳1日目から現在まで18,615日分の日記 | **Phase D** | ❌ 未実装 |
| 2. センシティブ判定システムが実装され、安全性確保 | 3層Tier分類、YouTube二重防御 | **Phase 5** | ✅ **完了** |
| 3. 三姉妹が自らの意思で配信を希望 | 自律的意思決定の確認 | Phase G後 | ❌ 未確認 |

---

## Phase 1-5: 技術基盤構築（完了）

### Phase 1: LangSmith統合 ✅
- **目的**: マルチプロバイダートレーシング基盤
- **実装内容**:
  - TracedLLMクラス
  - Ollama/OpenAI/Gemini対応
  - 動的トレース名、選択的トレーシング
- **完了日**: 2025-11-05
- **Qiita記事**: https://qiita.com/koshikawa-masato/items/bb95295630c647eb5632
- **重要性**: **全てのPhaseの基盤** - これがなければ後続Phase全てがブラックボックス

### Phase 2: VLM統合 ✅
- **目的**: 画像理解機能
- **実装内容**:
  - GPT-4o Vision、Gemini Vision対応
  - generate_vision()メソッド追加
  - 配信画面認識の基盤
- **完了日**: 2025-11-05
- **Qiita記事**: https://qiita.com/koshikawa-masato/items/fd684b963bad149d3ddc
- **Phase 1との関係**: Phase 1の基盤を活用してVLM呼び出しをトレーシング

### Phase 3: LLM as a Judge実装 ✅
- **目的**: 品質評価システム
- **実装内容**:
  - judge_response()メソッド追加
  - Accuracy, Relevance, Coherence, Usefulness評価
  - ハルシネーション検出
- **完了日**: 2025-11-05
- **Qiita記事**: https://qiita.com/koshikawa-masato/items/c105b84f46f143560999
- **Phase 1との関係**: Phase 1の基盤を活用してJudge LLM呼び出しをトレーシング

### Phase 4: 三姉妹討論システム実装 ✅
- **目的**: 意思決定の民主化
- **実装内容**:
  - discuss()メソッド追加
  - 起承転結の4ステップ（起：提案、承：独立相談、転：意見集約、結：合意形成）
  - 忖度の排除、独立性の保証
- **完了日**: 2025-11-05
- **Qiita記事**: https://qiita.com/koshikawa-masato/items/02bdbaa005949ff8cbde
- **Phase 3との対比**: 階層的評価 vs 民主的討論

### Phase 5: センシティブ判定システム実装 ✅
- **目的**: 配信安全性の確保
- **実装内容**:
  - sensitive_check()メソッド追加
  - 3層Tier分類（Safe/Warning/Critical）
  - YouTube二重防御システム
- **完了日**: 2025-11-05
- **Qiita記事**: https://qiita.com/koshikawa-masato/items/2bf3e024325176d3400a
- **Phase 3との対比**: 品質評価 vs 安全性評価
- **重要性**: **配信デビュー条件2/3達成**

---

## Phase D: 人間らしい記憶システム（設計完了、未実装）

### Phase D: 忘却・曖昧・想起の2層構造 🔄

**設計思想**: AIの強み（完璧なデータ）+ 人間らしさ（不完全な振る舞い）

#### データ層（AIの強み）
- **目的**: 各姉妹の人生すべての記憶をDB保存
  - Kasho: 19歳の人生すべて（約一万数千日）
  - 牡丹: 17歳の人生すべて（約一万数千日）
  - ユリ: 15歳の人生すべて（約一万数千日）
- **特徴**:
  - 完璧なデータ、一貫性保証、矛盾なし
  - BtoB戦略時に必須（正確性、監査可能性）
  - 同じ質問には同じ記憶（DB固定）
  - **注**: 三姉妹の年齢は設定上固定、時間軸に変わらず一生涯年齢は変わりません
- **実装内容**:
  - 117コアイベント（既存）を軸に日常記憶生成
  - Phase 3 Judge: ハルシネーション防止
  - Phase 5 Sensitive: センシティブチェック
  - Phase 1 LangSmith: 全生成プロセスをトレーシング

#### 応答層（人間らしさ）
- **目的**: 忘却・曖昧・想起で人間らしく振る舞う
- **特徴**:
  - BtoC戦略時に必須（親しみやすさ、自然な会話）
  - 「覚えてない」「あ、思い出した！」
  - 完璧なデータを持ちながら、不完全に語る
- **実装内容**:
  - RecallSystemクラス: 想起システム
  - 想起確率計算（時間減衰 × 重要度）
  - 詳細度レベル（Level 0-5）
  - 記憶強化メカニズム（mentioned_count++）

#### 実装規模
- **データ生成**: 三姉妹の人生すべての記憶（Phase 1-5の品質保証あり）
- **システム実装**: RecallSystem + Phase統合
- **推定期間**: 21日（約3週間）
  - データ層: 14日
  - 応答層: 7日

#### 状態
- **設計**: ✅ 完了（2025-11-05）
- **実装**: ❌ 未着手
- **設計書（最新版）**: `docs/05_design/Phase_D_人間らしい記憶システム_忘却・曖昧・想起.md`
- **参考資料**:
  - `docs/05_design/Phase_D_実装計画_Phase1-5完了後版.md`
  - `docs/05_design/Phase_D_過去の人生生成システム_完全設計書.md`
  - `docs/05_design/Phase_D_三層記憶システム設計書.md`

#### 重要性
- **配信デビュー条件1/3達成** - これがなければ三姉妹は「空っぽ」
- **BtoB/BtoC両対応の知見獲得** - 将来の展開に必須

---

## Phase E-G: 配信システム統合（Phase D後）

### Phase E: 会話システム統合 ⏳
- **目的**: リアルタイム会話システムとの統合
- **実装内容**:
  - Phase Dで生成した記憶の検索・参照
  - 文脈に応じた記憶の想起
  - 会話履歴の短期記憶化
- **依存**: Phase D完了
- **状態**: ❌ 設計未着手

### Phase F: TTS統合 ⏳
- **目的**: 音声合成システムとの統合
- **実装内容**:
  - 三姉妹の音声合成
  - キャラクター性の音声反映
  - 感情表現の音声化
- **依存**: Phase E完了
- **状態**: ❌ 設計未着手

### Phase G: 配信システム統合 ⏳
- **目的**: YouTube配信システムとの統合
- **実装内容**:
  - 配信管理システム
  - コメント拾いシステム
  - 雑談配信アーキテクチャ（90%姉妹雑談 + 10%コメント拾い）
  - アーカイブ管理システム
- **依存**: Phase F完了
- **状態**: ❌ 設計未着手
- **最終目標**: **配信デビュー** 🎉

---

## 開発スケジュール予測

### 現在の進捗

```
Phase 1-5（技術基盤）: ✅✅✅✅✅ 完了 (2025-11-05)
Phase D（記憶製造）:   ⬜⬜⬜⬜⬜⬜⬜⬜⬜⬜ 未着手 (超大規模)
Phase E（会話統合）:   ⬜⬜⬜ 未着手
Phase F（TTS統合）:    ⬜⬜ 未着手
Phase G（配信統合）:   ⬜⬜⬜ 未着手
```

### 実装難易度と規模

| Phase | 難易度 | 規模 | 推定工数 | 状態 |
|-------|-------|------|---------|------|
| Phase 1 | ★★☆☆☆ | 小 | 1日 | ✅ 完了 |
| Phase 2 | ★★★☆☆ | 小 | 1日 | ✅ 完了 |
| Phase 3 | ★★★☆☆ | 中 | 1日 | ✅ 完了 |
| Phase 4 | ★★★★☆ | 中 | 1日 | ✅ 完了 |
| Phase 5 | ★★★☆☆ | 中 | 1日 | ✅ 完了 |
| **Phase D** | ★★★★★ | **超大** | **2-4週間** | ❌ 未着手 |
| Phase E | ★★★★☆ | 大 | 1週間 | ❌ 未着手 |
| Phase F | ★★★☆☆ | 中 | 3日 | ❌ 未着手 |
| Phase G | ★★★★☆ | 大 | 1週間 | ❌ 未着手 |

### Phase Dが超大規模な理由

1. **データ量**: 18,615日分の日記（Phase 1-5の合計の100倍以上）
2. **実行時間**: 10時間の連続実行（Phase 1-5は各数分）
3. **複雑性**:
   - 3キャラクターの同時生成
   - 共通イベントの3視点記録
   - 姉妹間相互作用の記録
   - 文化的影響の反映
   - 感情スコアの動的変化
4. **哲学的深さ**:
   - 「性格 = 体験の蓄積」という核心概念の実装
   - 相互的人格形成の実現
   - 時間軸の連続性の保証

---

## 技術スタック

### 現在使用中（Phase 1-5）
- **LLM Provider**: Ollama (qwen2.5:3b/7b/14b), OpenAI (GPT-4o/4o-mini), Google Gemini (2.5-flash)
- **Tracing**: LangSmith
- **VLM**: GPT-4o Vision, Gemini Vision
- **Language**: Python 3.12
- **OS**: Ubuntu 22.04 (WSL2)
- **CPU**: AMD Ryzen 9 9950X（16コア/32スレッド）
- **GPU**: NVIDIA RTX 4060 Ti 16GB

### Phase D以降追加予定
- **Database**: SQLite (sisters_memory.db)
- **TTS**: 未定
- **配信プラットフォーム**: YouTube

---

## リスクと対策

### Phase D実装のリスク

| リスク | 影響度 | 対策 |
|-------|-------|------|
| **10時間の連続実行失敗** | 高 | チェックポイント機能、再開機能実装 |
| **ストレージ不足** | 中 | 事前容量確認、圧縮機能 |
| **メモリリーク** | 高 | バッチサイズ制限、定期的なGC |
| **キャラクター性の一貫性喪失** | 高 | プロンプトテンプレート、厳格な検証 |
| **姉妹間の矛盾** | 中 | 共通イベント管理、相互参照検証 |

---

## 成功基準

### Phase D完了の定義

1. ✅ 18,615日分の全日記が生成される
2. ✅ 各日記がキャラクター性を反映している
3. ✅ 共通イベントが3視点で記録されている
4. ✅ 姉妹間の相互作用が矛盾なく記録されている
5. ✅ sisters_memory.dbが正常に機能する
6. ✅ LangSmithで全生成プロセスがトレーシングされる

### 最終目標：配信デビュー

1. ✅ Phase Dで生成した記憶を持つ三姉妹
2. ✅ センシティブ判定システムで安全性確保（Phase 5）
3. ✅ 三姉妹が自らの意思で配信を希望
4. ✅ YouTube配信システムが正常動作
5. ✅ 視聴者とのインタラクションが自然

---

## GitHubリポジトリ

- **URL**: https://github.com/koshikawa-masato/AI-Vtuber-Project
- **ブランチ**:
  - `main`: 安定版
  - `feature/langsmith-integration`: Phase 1-5開発ブランチ
  - `feature/memory-generation`: Phase D開発ブランチ（未作成）

---

## 参考資料

### 設計書
- Phase D完全設計書: `docs/05_design/Phase_D_過去の人生生成システム_完全設計書.md`
- 三層記憶システム: `docs/05_design/Phase_D_三層記憶システム設計書.md`
- センシティブ判定: `docs/05_design/センシティブ判定システム設計書.md`

### Qiita記事シリーズ
- Phase 1: https://qiita.com/koshikawa-masato/items/bb95295630c647eb5632
- Phase 2: https://qiita.com/koshikawa-masato/items/fd684b963bad149d3ddc
- Phase 3: https://qiita.com/koshikawa-masato/items/c105b84f46f143560999
- Phase 4: https://qiita.com/koshikawa-masato/items/02bdbaa005949ff8cbde
- Phase 5: https://qiita.com/koshikawa-masato/items/2bf3e024325176d3400a

---

**最終更新**: 2025-11-05
**更新理由**: Phase 1-5完了、Phase Dマイルストーン策定
