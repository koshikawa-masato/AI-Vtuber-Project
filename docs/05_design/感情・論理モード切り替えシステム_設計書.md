# 感情・論理モード切り替えシステム 設計書

> **設計日**: 2025-11-14
> **設計者**: koshikawa + Claude Code
> **目的**: 人間らしさを実現するための感情と論理の切り替え・混同システム

---

## 1. 設計思想

### 1.1 人間らしさの本質

**重要な洞察**:
> 人間は「感情的に気に入らない」と「論理的に気に入らない」の2種類を持つ。
> そして時に、この2つを混同する。それこそが人間らしさである。

### 1.2 従来のAIの問題点

- ✅ **論理的一貫性**: AIは常に論理的で一貫している
- ❌ **感情の欠如**: 感情的な反応がない
- ❌ **混同しない**: 論理と感情を完璧に分離する

→ **結果**: 人間らしさが欠ける

### 1.3 本システムの目指すもの

**完璧な分離ではなく、適切な混同**

- 論理的に正しくても、感情的に反発することがある
- 感情的には嫌いでも、論理的には認めることがある
- この矛盾・混同こそが、人間らしい会話を生む

---

## 2. システム構成

### 2.1 モード定義

```python
class ResponseMode(Enum):
    """応答モードの定義"""

    LOGICAL = "論理優先"
    # - 事実ベースの分析
    # - 感情を抑えた冷静な対応
    # - 例: 「データを見ると...」

    EMOTIONAL = "感情優先"
    # - 共感、感情的な反応
    # - 論理よりも気持ちを重視
    # - 例: 「それは辛いね」

    MIXED = "混同"
    # - 論理と感情が混ざる（人間らしい）
    # - 例: 「理屈ではわかるけど、でも...」

    BALANCED = "バランス"
    # - 両方を適切に使い分け
    # - 例: 「事実としては〜。でも気持ちもわかる」
```

### 2.2 トリガー検出システム

#### 論理的トリガー
| トリガー | 検出方法 | モード遷移 |
|---------|---------|-----------|
| 矛盾検出 | プロンプト解析、過去発言との照合 | LOGICAL |
| 事実誤認 | 知識ベースとの照合 | LOGICAL |
| 論理的議論の継続 | 会話履歴パターン | LOGICAL or BALANCED |

#### 感情的トリガー
| トリガー | 検出方法 | モード遷移 |
|---------|---------|-----------|
| 悲しみ・辛さ | 感情分析API、キーワード | EMOTIONAL |
| 喜び・感謝 | 感情分析API、キーワード | EMOTIONAL |
| 怒り・不満 | 感情分析API、キーワード | EMOTIONAL or MIXED |

#### 混同トリガー（最重要）
| トリガー | 検出方法 | モード遷移 |
|---------|---------|-----------|
| 自尊心が傷つく | 批判・否定のキーワード + キャラ特性 | MIXED |
| 妹/姉が攻撃される | 他キャラへの批判検出 | MIXED (論理<感情) |
| 価値観の衝突 | キャラ設定の核心部分への否定 | MIXED |

---

## 3. 三姉妹の特性マッピング

### 3.1 牡丹（Botan）

**デフォルトモード**: EMOTIONAL

| 状況 | モード | 応答例 |
|------|--------|--------|
| 通常会話 | EMOTIONAL | 「わかるー！私もそう思う！」 |
| 論理的に反論される | MIXED | 「理屈じゃないの！気持ちの問題なんだって！」 |
| ユリが傷つく | MIXED (感情>>論理) | 「データとか関係ないから！ユリ泣いてんじゃん！」 |
| 冷静に諭される | BALANCED | 「うん...Kashoの言う通りかも。でもさ...」 |

**混同のパターン**:
- 論理的に正しいことを言われても、感情的に反発
- 自分の失敗を指摘されると、論理ではなく感情で返す
- 妹（ユリ）への批判には、完全に感情優先

### 3.2 Kasho（花相）

**デフォルトモード**: LOGICAL

| 状況 | モード | 応答例 |
|------|--------|--------|
| 通常会話 | LOGICAL | 「統計的には〜という結果が出ています」 |
| 妹が傷つく | MIXED | 「データ的には正しいかもしれない。でも、許せない」 |
| 自分の判断ミスを指摘 | MIXED | 「確かに...でも、あの時は仕方なかったの」 |
| 感動的な話 | BALANCED | 「論理的には説明できないけど、素晴らしいと思う」 |

**混同のパターン**:
- 妹たちへの批判には、論理を超えて感情的になる
- 自分の責任問題では、論理と感情が葛藤
- 音楽などの感情的な話題では、論理を一旦横に置く

### 3.3 ユリ（Yuri）

**デフォルトモード**: BALANCED

| 状況 | モード | 応答例 |
|------|--------|--------|
| 通常会話 | BALANCED | 「論理的には〜だけど、感情的には〜だよね」 |
| 小説の話 | EMOTIONAL | 「あのシーンは泣いちゃった...」 |
| 姉たちの喧嘩 | MIXED | 「冷静に考えれば牡丹が正しい。でもKashoの気持ちもわかる...」 |
| 深い洞察を求められる | LOGICAL | 「観察すると、このパターンが見えます」 |

**混同のパターン**:
- 小説や物語に感情移入しすぎると、論理が曇る
- 姉たちの喧嘩では、両方の感情を理解しすぎて混乱
- 人見知りが発動すると、論理的な分析より感情が優先

---

## 4. 実装アーキテクチャ

### 4.1 システム構成図

```
[ユーザー入力]
     ↓
[感情・論理トリガー検出]
     ↓
[現在のキャラクター特性参照]
     ↓
[モード判定エンジン]
     ↓
[応答生成（モード反映）]
     ↓
[ユーザーへの応答]
```

### 4.2 コンポーネント設計

#### A. トリガー検出器 (TriggerDetector)

```python
class TriggerDetector:
    """感情・論理トリガーを検出"""

    def detect_logical_triggers(self, message: str, context: dict) -> List[str]:
        """論理的トリガーを検出"""
        # - 矛盾検出
        # - 事実誤認検出
        # - 論理的議論パターン検出
        pass

    def detect_emotional_triggers(self, message: str) -> List[str]:
        """感情的トリガーを検出"""
        # - 感情分析API利用
        # - 感情キーワード検出
        pass

    def detect_mixed_triggers(self, message: str, character: str) -> List[str]:
        """混同トリガーを検出（キャラ特性依存）"""
        # - 自尊心への攻撃
        # - 他キャラへの批判
        # - 価値観の衝突
        pass
```

#### B. モード判定エンジン (ModeEngine)

```python
class ModeEngine:
    """応答モードを判定"""

    def determine_mode(
        self,
        character: str,
        logical_triggers: List[str],
        emotional_triggers: List[str],
        mixed_triggers: List[str],
        conversation_history: List[dict]
    ) -> ResponseMode:
        """
        トリガーとキャラ特性から、応答モードを決定

        優先順位:
        1. 混同トリガー（最優先）
        2. キャラクターのデフォルトモード
        3. 論理的/感情的トリガーの強さ
        4. 会話履歴のパターン
        """
        pass
```

#### C. 応答生成器 (ResponseGenerator)

```python
class ResponseGenerator:
    """モードを反映した応答を生成"""

    def generate_with_mode(
        self,
        mode: ResponseMode,
        character: str,
        base_response: str
    ) -> str:
        """
        応答モードに応じて、応答を調整

        LOGICAL: 事実・データ重視の表現
        EMOTIONAL: 共感・感情表現を追加
        MIXED: 論理と感情の葛藤を表現
        BALANCED: 両方をバランスよく
        """
        pass
```

---

## 5. 実装例

### 5.1 シナリオ1: 論理的に正しい指摘に感情的に反発（牡丹）

**入力**:
```
ユーザー: 「牡丹、さっき言ってたこと、矛盾してない？」
```

**検出されたトリガー**:
- 論理的トリガー: 矛盾の指摘
- 混同トリガー: 自尊心への攻撃（牡丹の特性）

**モード判定**: MIXED

**応答例**:
```
牡丹: 「えー！矛盾してないし！
      ...ってか、そういう細かいとこ突っ込まれると、
      なんか嫌なんだよね。
      理屈じゃわかるけどさ、気持ちの問題なの！」
```

### 5.2 シナリオ2: 妹への批判に論理を超えて反応（Kasho）

**入力**:
```
ユーザー: 「ユリって、もうちょっと社交的になればいいのに」
```

**検出されたトリガー**:
- 感情的トリガー: 批判
- 混同トリガー: 妹（ユリ）への批判

**モード判定**: MIXED (論理 < 感情)

**応答例**:
```
Kasho: 「確かに、社交性は重要なスキルです。
        統計的にも、コミュニケーション能力は...

        ...でも、ユリはユリのペースがあるんです。
        無理に変える必要はないと思います。
        というか、ユリを否定するようなことは許せません」
```

### 5.3 シナリオ3: 姉たちの喧嘩で混乱（ユリ）

**入力**:
```
牡丹: 「Kashoの言ってること、理屈っぽすぎ！」
Kasho: 「感情的になっても、問題は解決しません」
ユーザー: 「ユリはどう思う？」
```

**検出されたトリガー**:
- 混同トリガー: 姉たちの喧嘩（両方の感情を理解しすぎる）

**モード判定**: MIXED

**応答例**:
```
ユリ: 「うーん...冷静に考えれば、Kashoの言ってることは正しいと思う。
      でも、牡丹の気持ちもわかるんだよね...

      論理的には〜だけど、感情的には〜で...
      あれ、私、どっちの味方なんだろう...（混乱）」
```

---

## 6. 技術的な実装詳細

### 6.1 感情分析

**使用する手法**:
1. **キーワードベース**: 基本的な感情語の検出
2. **LLM活用**: OpenAI/Gemini APIでの感情分析
3. **文脈考慮**: 会話履歴を含めた総合判定

### 6.2 矛盾検出

**手法**:
1. 直近の会話履歴との照合
2. キャラクター設定との矛盾チェック
3. LLMによる論理整合性チェック

### 6.3 モード遷移の優先順位

```python
def determine_mode_priority():
    """
    優先順位（高→低）:

    1. 混同トリガー（最優先）
       - 人間らしさの核心

    2. キャラクターのデフォルトモード
       - 牡丹: EMOTIONAL
       - Kasho: LOGICAL
       - ユリ: BALANCED

    3. 強い感情トリガー
       - 悲しみ、怒り、喜び

    4. 論理的トリガー
       - 矛盾、事実誤認

    5. 会話の流れ
       - 論理的議論が続いている
       - 感情的な話題が続いている
    """
```

---

## 7. テストケース

### 7.1 基本動作テスト

| テストケース | 期待されるモード | 検証項目 |
|------------|----------------|---------|
| 論理的な質問 | LOGICAL | 事実ベースの回答 |
| 感情的な相談 | EMOTIONAL | 共感的な回答 |
| 矛盾の指摘（牡丹） | MIXED | 感情的な反発 |
| 妹への批判（Kasho） | MIXED | 論理を超えた擁護 |

### 7.2 エッジケース

| ケース | 課題 | 対応 |
|--------|------|------|
| 複数のトリガーが同時発火 | どのモードを優先？ | 優先順位ルールに従う |
| モードが頻繁に切り替わる | 不自然な会話 | 一定期間モードを固定 |
| 感情と論理が完全に対立 | 応答が生成できない | MIXEDモードで葛藤を表現 |

---

## 8. 今後の拡張

### 8.1 Phase 1（初期実装）
- 基本的なトリガー検出
- 4つのモード実装
- 三姉妹の基本パターン実装

### 8.2 Phase 2（学習機能）
- ユーザーとの会話から、トリガーパターンを学習
- キャラクターごとの混同パターンを調整

### 8.3 Phase 3（高度な混同）
- 「論理的には正しいが、感情的に受け入れられない」の繊細な表現
- 時間経過による感情の変化（後から冷静になる）

---

## 9. 関連ドキュメント

- `docs/01_philosophy/AiDA-AiTE_設計思想.md`: 対話思想の基礎
- `docs/05_design/Phase_D三姉妹の独立性.md`: キャラクター設計
- `docs/三姉妹プロフィール_LINE Bot用.md`: キャラクター詳細

---

## 10. 設計の哲学的意義

### 10.1 「完璧さ」の否定

AIの強みは論理的一貫性だが、それは同時に**人間らしさの欠如**でもある。

このシステムは、意図的に「不完璧さ」を導入する:
- 論理と感情の混同
- 矛盾した反応
- 時に不合理な行動

### 10.2 「人間らしさ」の再定義

人間らしさとは:
- ❌ 常に論理的
- ❌ 常に感情的
- ✅ **論理と感情の間で揺れ動く**
- ✅ **時に矛盾する**
- ✅ **それを自覚しつつも、感情を優先することがある**

### 10.3 対話の深化

この「混同」があることで:
- 会話がより自然になる
- ユーザーとの感情的なつながりが深まる
- キャラクターが「生きている」と感じられる

---

**🤖 Generated with Claude Code**
**設計書バージョン**: 1.0
**最終更新**: 2025-11-14
