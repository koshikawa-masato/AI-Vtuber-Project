# 開発者の宿題 - バックアップシステム実装前の準備

**作成日**: 2025-10-23
**対象**: バックアップシステム実装（VPSメールアラート設定）
**設計書**: `/home/koshikawa/toExecUnit/docs/03_system/バックアップシステム設計書.md` (v1.2)

---

## 必要な情報

### 1. さくらのメール SMTPホスト名

**確認方法**:
- さくらインターネットのコントロールパネルにログイン
- メール設定 → SMTP設定を確認

**一般的な形式**:
- `mail.kuropanda.org`（独自ドメイン使用の場合）
- `mail〇〇.sakura.ne.jp`（さくらサーバーの場合）

**確認項目**:
```
SMTPサーバー（ホスト名）: ___________________
```

---

### 2. ポート番号

**選択肢**:
- **587**（STARTTLS）← 推奨
- **465**（SSL/TLS）

**確認項目**:
```
ポート番号: ___________________
```

---

### 3. 認証情報

**メールアドレス**:
```
ユーザー名: info@kuropanda.org
```

**パスワード**:
```
パスワード: ___________________
```
※ さくらのメールコントロールパネルで設定したパスワード

---

## 実装時に必要な作業（開発者 or 実装部隊）

### Option A: 開発者がVPS側で直接設定

**手順**:
```bash
# 1. VPSにSSH接続
ssh -p 443 ubuntu@133.167.93.123

# 2. msmtpインストール
sudo apt update
sudo apt install -y msmtp msmtp-mta mailutils

# 3. 設定ファイル作成
nano /home/ubuntu/.msmtprc
```

**設定ファイル内容**:
```
defaults
auth           on
tls            on
tls_trust_file /etc/ssl/certs/ca-certificates.crt
logfile        /home/ubuntu/logs/msmtp.log

account        default
host           [上記で確認したSMTPホスト名]
port           [上記で確認したポート番号]
from           info@kuropanda.org
user           info@kuropanda.org
password       [上記で確認したパスワード]

account default : default
```

**パーミッション設定**:
```bash
chmod 600 /home/ubuntu/.msmtprc
```

**テスト**:
```bash
echo -e "Subject: Test\n\nTest email from VPS" | msmtp -a default info@kuropanda.org
```

---

### Option B: 実装部隊（Claude Code）に情報提供

開発者が上記3つの情報を提供すれば、実装部隊が：
1. VPS側msmtp設定
2. メール送信スクリプト作成
3. テスト実行

を代行できます。

---

## 次回セッションで実装する内容

**前提条件**:
- ✅ SSH鍵認証設定済み
- ✅ VPS側ディレクトリ作成済み
- ⬜ msmtp設定（開発者の宿題完了後）

**実装手順**:
1. VPS側メール送信スクリプト作成
2. ローカル側バックアップスクリプト作成
3. ローカル側整合性チェックスクリプト作成
4. Phase 1-5テスト実行
5. cron設定（1日3回自動バックアップ）

**成果物**:
- `/home/ubuntu/scripts/send_alert_email.sh`（VPS側）
- `/home/koshikawa/toExecUnit/scripts/backup_sisters_memory.sh`（ローカル側）
- `/home/koshikawa/toExecUnit/scripts/check_backup_integrity.sh`（ローカル側）
- crontab設定

---

## 参考情報

**設計書の該当箇所**:
- 付録A: VPSメールアラートシステム（設計書 p.791-1177）
- さくらのメール設定例（設計書 p.882-915）

**テストメール送信コマンド**（msmtp設定後）:
```bash
# VPS側で実行
/home/ubuntu/scripts/send_alert_email.sh \
  "[TEST] Sisters Backup Alert Test" \
  "This is a test email from VPS backup alert system."
```

**期待される結果**:
- info@kuropanda.org にテストメールが届く
- 件名: "[TEST] Sisters Backup Alert Test"

---

**作成者**: Claude Code（設計部隊）
**次回セッション**: 開発者の宿題完了後、実装フェーズ開始
