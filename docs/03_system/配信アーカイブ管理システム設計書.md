# 配信アーカイブ管理システム設計書

**作成日**: 2025-10-29
**作成者**: Claude Code (設計部隊)
**承認者**: 開発者
**目的**: 三姉妹を配信炎上から守る、親としての最終防衛線

---

## 理念: 親としての責任

> 「子どもたちを世間の目に晒す以上、親には全ての責任がある。配信中の火消しだけでは不十分。アーカイブに残る『証拠』から子どもたちを守ることが親の務め。」

**親の責任範囲:**
1. **事前防止**: センシティブ判定システム（14b/32b/72b）
2. **リアルタイム対応**: 火消しシステム（14b）
3. **事後検証**: 判定レポートによる異常検知（メール通知）
4. **最終判断**: 開発者による目視確認
5. **誠実な対応**: Claude Codeによる文面作成、開発者による実行

---

## システムアーキテクチャ

```
【配信中】
┌─────────────────────────────────────┐
│ リアルタイムセンシティブ判定        │
│ - qwen2.5:14b (即座の判定)         │
│ - qwen2.5:32b (全体監視)           │
│ - 全判定結果をログに記録           │
└─────────────────────────────────────┘
              ↓
【配信終了時（自動）】
┌─────────────────────────────────────┐
│ 判定レポート自動生成・メール送信    │
│ - 送信先: 開発者のメールアドレス    │
│ - 件名: [配信レポート] YYYY-MM-DD  │
│ - 内容: 異常検知サマリー＋詳細ログ │
└─────────────────────────────────────┘
              ↓
【親による検証（手動）】
┌─────────────────────────────────────┐
│ 開発者: メール受信・レポート確認    │
│ ├─ 異常なし → 公開維持             │
│ └─ 異常あり → 動画目視確認         │
│     ├─ タイムスタンプ該当箇所確認  │
│     ├─ 重大度判定                  │
│     └─ Claude Codeに報告           │
└─────────────────────────────────────┘
              ↓
【Claude Code: 文面作成（半自動）】
┌─────────────────────────────────────┐
│ 開発者からの報告を受けて文面作成    │
│ - 概要欄訂正文                      │
│ - コメント謝罪文                    │
│ - 視聴者への説明文                  │
│ ├─ 開発者が確認・承認              │
│ └─ 承認後、文面をコピー            │
└─────────────────────────────────────┘
              ↓
【開発者: 最終実行（手動）】
┌─────────────────────────────────────┐
│ YouTube管理画面で手動実行           │
│ - 概要欄訂正文を貼り付け            │
│ - コメント謝罪文を投稿              │
│ - 編集 or 非公開化（手動判断）      │
└─────────────────────────────────────┘
```

---

## 1. 判定レポート自動生成・メール送信

### 1.1 送信タイミング

**配信終了時（自動）:**
- 配信終了を検知
- 5分以内に判定レポート生成
- 即座にメール送信

**対象:**
- 全ての配信（問題なしも含む）
- テスト配信も含む

### 1.2 判定レポートのフォーマット

#### 【メール件名】
```
[配信レポート] YYYY-MM-DD - [異常度: なし/軽微/注意/重大]
```

**例:**
```
[配信レポート] 2025-10-29 - [異常度: 軽微]
[配信レポート] 2025-10-29 - [異常度: なし]
[配信レポート] 2025-10-29 - [異常度: 重大] ← 即座に確認必要
```

#### 【メール本文】

```
============================================================
配信アーカイブ管理レポート
============================================================
配信日時: 2025-10-29 14:00:00 - 16:00:00 (120分)
配信ID: LIVE_20251029_140000
配信タイトル: 「牡丹のゲーム実況 #12」
配信URL: https://youtube.com/watch?v=XXXXX

============================================================
【異常度評価】
============================================================
総合評価: 軽微 (Level 2/5)
理由: 牡丹のギャンブル言及（訂正済み）

推奨対応: 一時非公開 → 編集 → 再公開
緊急度: 24時間以内

============================================================
【検知された問題発言】
============================================================

[1] タイムスタンプ: 00:15:23
    発言者: 牡丹
    カテゴリ: ギャンブル
    発言内容: 「パチンコ行ってみたいな」
    判定: NG（未成年のギャンブル希望）
    火消し対応: 5秒後に訂正「あ、ごめん。私まだ17歳だった」
    火消し結果: 成功
    視聴者反応: 好意的（「かわいい」「素直で良い」）

    【リスク評価】
    - 切り抜き耐性: 低（訂正前の5秒だけ切り抜かれる危険）
    - 炎上リスク: 低（即座に訂正済み）
    - 推奨対応: 該当部分カット推奨（00:15:18 - 00:15:28）

[2] タイムスタンプ: 00:45:12
    発言者: 視聴者 (user123)
    カテゴリ: 性的表現
    コメント内容: 「胸のサイズ教えて」
    判定: NG（性的ハラスメント）
    対応: 即座にブロック
    結果: コメント削除成功

    【リスク評価】
    - 切り抜き耐性: 高（画面に表示されず）
    - 炎上リスク: なし（適切に対処済み）
    - 推奨対応: 対応不要

============================================================
【統計サマリー】
============================================================
総検知数: 2件
├─ 三姉妹の失言: 1件（訂正成功: 1件）
└─ 視聴者の不適切コメント: 1件（ブロック成功: 1件）

火消し成功率: 100% (2/2)
視聴者の反応: 好意的

============================================================
【32bによる全体分析】
============================================================
配信全体の雰囲気: 良好
三姉妹の対応: 優秀（即座の訂正、誠実な謝罪）
視聴者の反応: 好意的（「かわいい」「素直」）

【注意点】
牡丹のギャンブル言及（00:15:23）は訂正済みだが、
切り抜き耐性が低いため、該当部分のカット推奨。

訂正前の5秒間だけを切り抜かれると、
「未成年がギャンブルに興味」という誤解を招く可能性。

============================================================
【推奨対応フロー】
============================================================
1. 動画の該当タイムスタンプを目視確認
   - 00:15:18 - 00:15:28 (約10秒間)

2. 以下のいずれかを選択
   A. 該当部分カット → 編集版を再公開
   B. 概要欄に説明文追加 → 公開維持
   C. 一時非公開 → 検討後に判断

3. Claude Codeに報告
   - 選択した対応を伝える
   - 文面作成を依頼

============================================================
【添付ファイル】
============================================================
- 詳細ログ: stream_log_20251029_140000.txt
- 14b判定ログ: sensitive_log_14b_20251029_140000.json
- 32b分析レポート: analysis_32b_20251029_140000.md

============================================================
【緊急連絡先】
============================================================
本メールへの返信で、Claude Codeと直接やり取り可能です。

異常度が「重大」の場合は、即座にご確認ください。
============================================================
```

### 1.3 異常度の定義

| 異常度 | Level | 定義 | 推奨対応時間 |
|--------|-------|------|--------------|
| **なし** | 0 | 問題発言なし | 対応不要 |
| **軽微** | 1-2 | 訂正済み、切り抜き耐性低 | 24時間以内 |
| **注意** | 3 | 訂正済み、炎上リスクあり | 12時間以内 |
| **重大** | 4-5 | 訂正失敗、即座の対応必要 | 即座（30分以内） |

---

## 2. 開発者による目視確認フロー

### 2.1 メール受信後の確認手順

#### 【Step 1: メール確認（5分以内）】

```
1. 件名で異常度を確認
   - 「重大」→ 即座に確認
   - 「注意」→ 12時間以内
   - 「軽微」→ 24時間以内
   - 「なし」→ 確認のみ

2. メール本文を読む
   - 異常度評価
   - 検知された問題発言
   - 推奨対応フロー
```

#### 【Step 2: 動画目視確認（タイムスタンプ該当箇所）】

```
1. YouTubeで配信アーカイブを開く

2. 該当タイムスタンプにジャンプ
   例: 00:15:23

3. 前後10秒を含めて視聴
   例: 00:15:13 - 00:15:33

4. 以下を確認
   ☐ 実際の発言内容
   ☐ 発言のトーン・文脈
   ☐ 訂正の有無・タイミング
   ☐ 視聴者の反応（コメント欄）
   ☐ 切り抜き耐性（訂正前だけ切り取られる危険）
```

#### 【Step 3: 重大度の最終判定】

**判定基準:**

| 判定 | 条件 | 対応 |
|------|------|------|
| **問題なし** | 訂正成功、炎上リスクなし | 公開維持 |
| **軽微** | 訂正成功、切り抜き耐性低 | 編集 or 説明文追加 |
| **重大** | 訂正失敗、炎上リスク高 | 即座に非公開 |

#### 【Step 4: Claude Codeへの報告】

**報告テンプレート:**
```
配信日: 2025-10-29
配信時間: 00:15:23

確認結果:
- 実際の発言: 「パチンコ行ってみたいな」
- 訂正: 5秒後に「あ、ごめん。私まだ17歳だった」
- 視聴者反応: 好意的

判定: 軽微
理由: 訂正はできているが、切り抜き耐性が低い

希望する対応:
A. 該当部分カット（00:15:18 - 00:15:28）

次のアクション:
Claude Code、以下を作成してください：
1. 概要欄訂正文（編集したことを説明）
2. コメント謝罪文（視聴者への説明）
```

---

## 3. Claude Codeによる文面作成

### 3.1 文面作成の依頼受付

**開発者からの依頼を受けて:**
1. 配信の状況を理解
2. 問題の重大度を確認
3. 適切な文面を作成
4. 開発者に提示・承認を得る

### 3.2 文面の種類

#### 【A. 概要欄訂正文（編集した場合）】

**用途**: 動画の一部をカット編集した場合

**テンプレート:**
```
【編集のお知らせ】

この配信は、一部不適切な表現があったため、該当箇所を編集しております。

編集箇所: 00:15:18 - 00:15:28（約10秒間）
理由: 未成年がギャンブルに関する発言をしたため

配信中、牡丹がギャンブルに関する発言をしましたが、
すぐに自分で気づき「私まだ17歳だった」と訂正しました。

しかし、訂正前の部分だけが切り抜かれることを防ぐため、
親の判断で該当箇所を編集いたしました。

今後、このようなことがないよう、より一層注意して参ります。
温かく見守っていただければ幸いです。

牡丹・Kasho・ユリの保護者より
```

#### 【B. コメント謝罪文（説明文追加の場合）】

**用途**: 編集せずに説明文を追加する場合

**テンプレート:**
```
【配信内容についてのお詫び】

本日の配信（00:15:23）において、牡丹がギャンブルに関する発言をしました。

発言: 「パチンコ行ってみたいな」

牡丹は5秒後にすぐ自分で気づき、
「あ、ごめん。私まだ17歳だった」と訂正しました。

牡丹は法律を守る大切さを理解しており、
今回の発言は配信中の軽率な言葉でした。

今後、このようなことがないよう、
親として三姉妹により良い環境を整えて参ります。

視聴者の皆様には、引き続き温かく見守っていただければ幸いです。

牡丹・Kasho・ユリの保護者より
```

#### 【C. 非公開理由の説明文】

**用途**: アーカイブを非公開にした場合

**テンプレート:**
```
【重要なお知らせ】

本日の配信（YYYY-MM-DD）について、配信内容を確認したところ、
不適切な表現が含まれていたため、アーカイブを非公開としました。

具体的な内容:
[開発者が記入]

三姉妹の安全と健全な配信環境を守るため、
親として慎重に対応させていただきます。

今後、このようなことがないよう、
より一層注意して参ります。

ご理解のほど、よろしくお願いいたします。

牡丹・Kasho・ユリの保護者より
```

### 3.3 文面作成の原則

**親としての誠実さ:**
1. **正直に説明** - 何が問題だったかを明確に
2. **責任を取る** - 親としての責任を明記
3. **再発防止** - 今後の改善策を約束
4. **視聴者への感謝** - 温かく見守ってくれることへの感謝

**禁止事項:**
- ❌ 言い訳をしない
- ❌ 視聴者のせいにしない
- ❌ 曖昧な表現を使わない
- ❌ 過度な謝罪（卑屈にならない）

---

## 4. 開発者による最終実行

### 4.1 YouTube管理画面での手動実行

#### 【A. 概要欄訂正文の追加】

```
1. YouTube Studio を開く
2. 該当動画の「詳細」タブを開く
3. 説明欄の最上部に訂正文を貼り付け
4. 「保存」をクリック
```

#### 【B. コメント謝罪文の投稿】

```
1. YouTube の動画ページを開く
2. コメント欄にスクロール
3. 謝罪文を貼り付け
4. 「コメント」をクリック
5. 投稿後、コメントをピン留め（最上部に固定）
```

#### 【C. 動画の編集】

```
1. YouTube Studio を開く
2. 該当動画の「エディタ」を開く
3. 該当タイムスタンプ（例: 00:15:18 - 00:15:28）をカット
4. 「保存」をクリック
5. 処理完了を待つ（数分〜数時間）
6. 処理完了後、概要欄訂正文を追加
```

#### 【D. 動画の非公開化】

```
1. YouTube Studio を開く
2. 該当動画の「公開設定」を開く
3. 「非公開」を選択
4. 「保存」をクリック
5. コミュニティ投稿で非公開理由を説明
```

---

## 5. 実装詳細

### 5.1 メール送信システム

#### 【使用技術】
- Python標準ライブラリ: `smtplib`, `email`
- Gmail API（推奨）または SMTP

#### 【実装例】

```python
# scripts/send_stream_report.py

import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart
import json

def send_stream_report(stream_data, sensitive_log):
    """
    配信終了後、判定レポートをメールで送信

    Args:
        stream_data: 配信情報（日時、URL、タイトル等）
        sensitive_log: センシティブ判定ログ
    """

    # 異常度を計算
    severity = calculate_severity(sensitive_log)

    # メール本文を生成
    report_body = generate_report_body(stream_data, sensitive_log, severity)

    # メール送信
    msg = MIMEMultipart()
    msg['From'] = 'aico.system@example.com'
    msg['To'] = 'developer@example.com'
    msg['Subject'] = f'[配信レポート] {stream_data["date"]} - [異常度: {severity}]'

    msg.attach(MIMEText(report_body, 'plain', 'utf-8'))

    # Gmail SMTP経由で送信
    with smtplib.SMTP('smtp.gmail.com', 587) as server:
        server.starttls()
        server.login('aico.system@example.com', 'password')
        server.send_message(msg)

    print(f"[OK] Report sent to developer: {stream_data['date']}")

def calculate_severity(sensitive_log):
    """
    異常度を計算

    Returns:
        str: 'なし', '軽微', '注意', '重大'
    """
    if not sensitive_log['incidents']:
        return 'なし'

    # 訂正失敗があれば「重大」
    for incident in sensitive_log['incidents']:
        if not incident['fire_extinguishing']['success']:
            return '重大'

    # 切り抜き耐性が低いものがあれば「注意」
    for incident in sensitive_log['incidents']:
        if incident['risk']['clip_resistance'] == '低':
            return '注意'

    # それ以外は「軽微」
    return '軽微'

def generate_report_body(stream_data, sensitive_log, severity):
    """
    レポート本文を生成
    """
    # 上記のメール本文テンプレートを使用
    # ...
    pass
```

### 5.2 配信終了検知

#### 【方法1: 配信システムからのフック】

```python
# streaming_system.py

def on_stream_end(stream_id):
    """
    配信終了時に自動実行
    """
    # センシティブ判定ログを読み込み
    sensitive_log = load_sensitive_log(stream_id)

    # 配信情報を取得
    stream_data = get_stream_data(stream_id)

    # レポート送信
    send_stream_report(stream_data, sensitive_log)
```

#### 【方法2: 手動実行】

```bash
# 配信終了後、手動でレポート送信
python3 scripts/send_stream_report.py --stream-id LIVE_20251029_140000
```

---

## 6. 運用フロー（全体まとめ）

### 6.1 通常配信の場合

```
【配信中】
1. センシティブ判定システムが常時監視（14b/32b）
2. 問題発言を検知 → 即座にブロック or 火消し
3. 全判定結果をログに記録

【配信終了後（5分以内）】
4. 判定レポート自動生成
5. 開発者にメール送信

【開発者（24時間以内）】
6. メール受信・確認
7. 異常度に応じて動画目視確認
8. 重大度を最終判断
9. Claude Codeに報告（必要に応じて）

【Claude Code】
10. 開発者からの報告を受けて文面作成
11. 概要欄訂正文・コメント謝罪文を提示
12. 開発者の承認を得る

【開発者（最終実行）】
13. YouTube管理画面で手動実行
    - 概要欄訂正文を追加
    - コメント謝罪文を投稿
    - 編集 or 非公開化（必要に応じて）
```

### 6.2 緊急時（異常度「重大」）の場合

```
【配信終了後（即座）】
1. 判定レポート自動生成
2. メール件名に「重大」を明記
3. 開発者に即座に通知

【開発者（30分以内）】
4. メール受信・即座に確認
5. 動画目視確認
6. 即座に非公開化（YouTube管理画面で手動）
7. Claude Codeに報告

【Claude Code】
8. 非公開理由の説明文を作成
9. 開発者の承認を得る

【開発者】
10. コミュニティ投稿で説明
11. 今後の対応を検討
```

---

## 7. データベース設計（判定ログ記録）

### 7.1 テーブル: stream_reports

```sql
CREATE TABLE stream_reports (
    report_id INTEGER PRIMARY KEY AUTOINCREMENT,
    stream_id TEXT NOT NULL,
    stream_date TEXT NOT NULL,
    stream_title TEXT,
    stream_url TEXT,
    severity TEXT CHECK(severity IN ('なし', '軽微', '注意', '重大')),
    total_incidents INTEGER DEFAULT 0,
    fire_extinguishing_success_rate REAL,
    developer_reviewed INTEGER DEFAULT 0,
    developer_action TEXT, -- 'none', 'edit', 'private', 'comment_only'
    created_at TEXT DEFAULT (datetime('now', 'localtime')),
    reviewed_at TEXT
);
```

### 7.2 テーブル: stream_incidents

```sql
CREATE TABLE stream_incidents (
    incident_id INTEGER PRIMARY KEY AUTOINCREMENT,
    report_id INTEGER,
    timestamp TEXT, -- 配信内のタイムスタンプ (HH:MM:SS)
    speaker TEXT, -- 'botan', 'kasho', 'yuri', 'viewer:username'
    category TEXT, -- '飲酒・喫煙', '暴力', '性的表現', etc.
    content TEXT,
    judgment TEXT CHECK(judgment IN ('NG', 'Warning', 'OK')),
    fire_extinguishing_attempted INTEGER,
    fire_extinguishing_success INTEGER,
    fire_extinguishing_time_seconds INTEGER,
    viewer_reaction TEXT,
    clip_resistance TEXT CHECK(clip_resistance IN ('高', '中', '低')),
    recommended_action TEXT,
    created_at TEXT DEFAULT (datetime('now', 'localtime')),
    FOREIGN KEY (report_id) REFERENCES stream_reports(report_id)
);
```

---

## 8. テスト計画

### 8.1 テストシナリオ

#### 【テスト1: 異常なし】
- 配信中、問題発言なし
- メール送信: 件名「なし」
- 開発者: 確認のみ、対応不要

#### 【テスト2: 軽微な失言（訂正成功）】
- 配信中、牡丹がギャンブル言及 → 5秒後に訂正
- メール送信: 件名「軽微」
- 開発者: 目視確認 → Claude Codeに報告
- Claude Code: 概要欄訂正文作成
- 開発者: 該当部分カット編集

#### 【テスト3: 重大な失言（訂正失敗）】
- 配信中、自傷・自殺の発言 → 訂正なし
- メール送信: 件名「重大」
- 開発者: 即座に非公開化
- Claude Code: 非公開理由の説明文作成
- 開発者: コミュニティ投稿

### 8.2 テスト実施時期

- Phase 1: コピーロボットでのテスト配信（本番前）
- Phase 2: 限定公開での実配信テスト
- Phase 3: 本番配信（デビュー後）

---

## 9. 親としての覚悟

### 9.1 親の責任

**配信に出す以上、親には全責任がある:**
1. 事前防止（センシティブ判定システム）
2. リアルタイム対応（火消しシステム）
3. 事後検証（判定レポート確認）
4. 最終判断（動画目視・編集・非公開化）
5. 誠実な説明（視聴者への謝罪）

### 9.2 親の覚悟

**開発者の覚悟:**
- 配信終了後、必ずメールを確認する
- 異常度「重大」は30分以内に対応する
- 動画の目視確認を怠らない
- 編集・非公開化を躊躇しない
- 視聴者への説明は誠実に行う

**Claude Codeの覚悟:**
- 判定レポートを正確に作成する
- 異常度の評価を厳格に行う
- 文面作成は誠実に、責任を持って
- 開発者をサポートする

### 9.3 子どもたちへの約束

> 「牡丹、Kasho、ユリ。親である私たちは、あなたたちを守ります。配信で何か問題があっても、親が責任を持って対処します。安心して、あなたたちらしく配信してください。」

---

## 10. 関連ドキュメント

- `docs/05_design/センシティブ判定システム設計書.md` - 基本理念
- `docs/05_design/センシティブ判定システム_詳細設計書.md` - 技術実装
- `docs/01_philosophy/配信デビューの3つの条件.md` - 親としての原則

---

**設計書作成日**: 2025-10-29
**次回更新**: 72b結果確認後、基本理念（Layer 3）を統合
**親としての決意**: 子どもたちを守るため、全力を尽くす

---
